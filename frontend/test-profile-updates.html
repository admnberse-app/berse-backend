<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Profile Updates</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h2 {
            color: #2fce98;
            border-bottom: 2px solid #2fce98;
            padding-bottom: 10px;
        }
        .test-item {
            padding: 10px;
            margin: 10px 0;
            border-left: 4px solid #ddd;
            background: #f9f9f9;
        }
        .test-item.pass {
            border-color: #4caf50;
            background: #e8f5e9;
        }
        .test-item.fail {
            border-color: #f44336;
            background: #ffebee;
        }
        .test-item.pending {
            border-color: #ff9800;
            background: #fff3e0;
        }
        button {
            background: #2fce98;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #26b584;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #2fce98;
            border-radius: 8px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>üß™ Bersemuka Profile Updates Test Suite</h1>
    
    <div class="test-section">
        <h2>1. Phone Number Input Test</h2>
        <div class="test-item pending" id="phone-test">
            <strong>Test:</strong> International phone number selector
            <div class="result" id="phone-result"></div>
        </div>
        <button onclick="testPhoneInput()">Run Phone Input Test</button>
    </div>

    <div class="test-section">
        <h2>2. Age Calculation Test</h2>
        <div class="test-item pending" id="age-test">
            <strong>Test:</strong> Calculate age from date of birth
            <div class="result" id="age-result"></div>
        </div>
        <button onclick="testAgeCalculation()">Run Age Calculation Test</button>
    </div>

    <div class="test-section">
        <h2>3. Default Data Test</h2>
        <div class="test-item pending" id="defaults-test">
            <strong>Test:</strong> No hardcoded organizations/events
            <div class="result" id="defaults-result"></div>
        </div>
        <button onclick="testDefaultData()">Run Default Data Test</button>
    </div>

    <div class="test-section">
        <h2>4. Profile Completion Test</h2>
        <div class="test-item pending" id="completion-test">
            <strong>Test:</strong> Profile completion flow
            <div class="result" id="completion-result"></div>
        </div>
        <button onclick="testProfileCompletion()">Run Profile Completion Test</button>
    </div>

    <div class="test-section">
        <h2>5. Visual Test</h2>
        <p>Open the app below and check:</p>
        <ul>
            <li>‚úÖ Phone number input shows country flags and codes</li>
            <li>‚úÖ Age is calculated from DOB (not manual input)</li>
            <li>‚úÖ No default "Berse Community" for new users</li>
            <li>‚úÖ Empty states show for communities/interests</li>
        </ul>
        <iframe src="http://localhost:5173" id="app-frame"></iframe>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api/v1';
        
        async function testPhoneInput() {
            const testDiv = document.getElementById('phone-test');
            const resultDiv = document.getElementById('phone-result');
            
            try {
                // Check if phone input component is loaded
                const response = await fetch('http://localhost:5173/src/screens/RegisterScreen.tsx');
                const text = await response.text();
                
                if (text.includes('PhoneInput') && text.includes('react-phone-number-input')) {
                    testDiv.className = 'test-item pass';
                    resultDiv.innerHTML = '‚úÖ Phone input component properly imported and configured';
                } else {
                    testDiv.className = 'test-item fail';
                    resultDiv.innerHTML = '‚ùå Phone input component not found';
                }
            } catch (error) {
                testDiv.className = 'test-item fail';
                resultDiv.innerHTML = '‚ùå Error: ' + error.message;
            }
        }

        async function testAgeCalculation() {
            const testDiv = document.getElementById('age-test');
            const resultDiv = document.getElementById('age-result');
            
            try {
                // Test age calculation function
                const testDOB = '2000-01-15';
                const today = new Date();
                const birthDate = new Date(testDOB);
                let age = today.getFullYear() - birthDate.getFullYear();
                const monthDiff = today.getMonth() - birthDate.getMonth();
                
                if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
                    age--;
                }
                
                const expectedAge = age;
                
                testDiv.className = 'test-item pass';
                resultDiv.innerHTML = `‚úÖ Age calculation working: DOB ${testDOB} = ${expectedAge} years old`;
            } catch (error) {
                testDiv.className = 'test-item fail';
                resultDiv.innerHTML = '‚ùå Error: ' + error.message;
            }
        }

        async function testDefaultData() {
            const testDiv = document.getElementById('defaults-test');
            const resultDiv = document.getElementById('defaults-result');
            
            try {
                // Check ProfileScreen for removed defaults
                const response = await fetch('http://localhost:5173/src/screens/ProfileScreen.tsx');
                const text = await response.text();
                
                const hasDefaultCommunity = text.includes("'üèõÔ∏è Berse Community'");
                const hasDefaultServices = text.includes("['Meet & Greet']");
                const hasDefaultInterests = text.includes("['Community', 'Events', 'Social']");
                
                if (!hasDefaultCommunity && !hasDefaultServices) {
                    testDiv.className = 'test-item pass';
                    resultDiv.innerHTML = '‚úÖ Default data removed - arrays start empty';
                } else {
                    testDiv.className = 'test-item fail';
                    resultDiv.innerHTML = `‚ùå Still has defaults: Community: ${hasDefaultCommunity}, Services: ${hasDefaultServices}`;
                }
            } catch (error) {
                testDiv.className = 'test-item fail';
                resultDiv.innerHTML = '‚ùå Error: ' + error.message;
            }
        }

        async function testProfileCompletion() {
            const testDiv = document.getElementById('completion-test');
            const resultDiv = document.getElementById('completion-result');
            
            try {
                // Test profile completion flow
                const token = localStorage.getItem('bersemuka_token');
                
                if (token) {
                    const response = await fetch(`${API_URL}/users/profile`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        const missingFields = [];
                        
                        if (!data.data?.dateOfBirth) missingFields.push('dateOfBirth');
                        if (!data.data?.bio) missingFields.push('bio');
                        if (!data.data?.profession) missingFields.push('profession');
                        
                        if (missingFields.length > 0) {
                            testDiv.className = 'test-item pass';
                            resultDiv.innerHTML = `‚úÖ Profile completion needed for: ${missingFields.join(', ')}`;
                        } else {
                            testDiv.className = 'test-item pass';
                            resultDiv.innerHTML = '‚úÖ Profile is complete';
                        }
                    } else {
                        testDiv.className = 'test-item pending';
                        resultDiv.innerHTML = '‚ö†Ô∏è Not logged in - please login to test';
                    }
                } else {
                    testDiv.className = 'test-item pending';
                    resultDiv.innerHTML = '‚ö†Ô∏è No auth token - please login first';
                }
            } catch (error) {
                testDiv.className = 'test-item fail';
                resultDiv.innerHTML = '‚ùå Error: ' + error.message;
            }
        }

        // Run all tests on load
        window.onload = function() {
            console.log('Running automated tests...');
            setTimeout(() => {
                testPhoneInput();
                testAgeCalculation();
                testDefaultData();
            }, 1000);
        };
    </script>
</body>
</html>