generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model announcement_analytics {
  id             String        @id
  announcementId String
  userId         String?
  viewed         Boolean       @default(false)
  viewedAt       DateTime?
  clicked        Boolean       @default(false)
  clickedAt      DateTime?
  dismissed      Boolean       @default(false)
  dismissedAt    DateTime?
  viewedFrom     String?
  deviceInfo     Json?
  createdAt      DateTime      @default(now())
  announcements  announcements @relation(fields: [announcementId], references: [id], onDelete: Cascade)

  @@index([announcementId, viewed])
  @@index([userId])
}

model announcements {
  id                     String                   @id
  title                  String
  content                String
  excerpt                String?
  imageUrl               String?
  thumbnailUrl           String?
  videoUrl               String?
  priority               AnnouncementPriority     @default(NORMAL)
  displayType            String                   @default("banner")
  targetAudience         String                   @default("all")
  targetCountries        String[]                 @default([])
  targetUserSegment      String[]                 @default([])
  minAppVersion          String?
  ctaText                String?
  ctaUrl                 String?
  ctaAction              String?
  publishedAt            DateTime?
  expiresAt              DateTime?
  isActive               Boolean                  @default(true)
  isPinned               Boolean                  @default(false)
  isDismissible          Boolean                  @default(true)
  viewCount              Int                      @default(0)
  clickCount             Int                      @default(0)
  createdBy              String?
  tags                   String[]                 @default([])
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  announcement_analytics announcement_analytics[]

  @@index([expiresAt])
  @@index([isActive, publishedAt])
  @@index([isPinned, isActive])
  @@index([priority, isActive])
}

model app_configs {
  id          String   @id
  configKey   String   @unique
  configValue String
  dataType    String   @default("string")
  category    String   @default("general")
  description String?
  isPublic    Boolean  @default(false)
  isEditable  Boolean  @default(true)
  updatedBy   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([category, isPublic])
  @@index([configKey])
}

model app_notice_dismissals {
  id          String      @id
  noticeId    String
  userId      String
  dismissedAt DateTime    @default(now())
  app_notices app_notices @relation(fields: [noticeId], references: [id], onDelete: Cascade)

  @@unique([noticeId, userId])
  @@index([userId])
}

model app_notices {
  id                    String                  @id
  noticeType            AppNoticeType
  title                 String
  message               String
  icon                  String?
  displayLocation       String[]                @default(["home"])
  displayStyle          String                  @default("banner")
  priority              Int                     @default(0)
  isDismissible         Boolean                 @default(true)
  autoDismiss           Boolean                 @default(false)
  autoDismissSeconds    Int?
  targetAudience        String                  @default("all")
  targetUserIds         String[]                @default([])
  targetSegments        String[]                @default([])
  targetCountries       String[]                @default([])
  minAppVersion         String?
  ctaText               String?
  ctaAction             String?
  ctaUrl                String?
  startDate             DateTime                @default(now())
  endDate               DateTime?
  isActive              Boolean                 @default(true)
  impressionCount       Int                     @default(0)
  dismissCount          Int                     @default(0)
  clickCount            Int                     @default(0)
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  app_notice_dismissals app_notice_dismissals[]

  @@index([isActive, startDate, endDate])
  @@index([noticeType, isActive])
  @@index([priority, isActive])
}

model app_versions {
  id                  String      @id
  versionNumber       String
  versionCode         Int
  platform            AppPlatform
  releaseDate         DateTime
  releaseNotes        String
  releaseType         String      @default("stable")
  isForceUpdate       Boolean     @default(false)
  minSupportedVersion String?
  isActive            Boolean     @default(true)
  isCurrent           Boolean     @default(false)
  downloadUrl         String?
  storeUrl            String?
  features            Json?
  bugFixes            Json?
  improvements        Json?
  deprecations        Json?
  createdAt           DateTime    @default(now())
  updatedAt           DateTime

  @@unique([versionNumber, platform])
  @@index([platform, isActive])
  @@index([platform, isCurrent])
  @@index([releaseDate])
}

model auth_identities {
  id          String   @id
  userId      String
  provider    String
  providerUid String
  email       String?
  createdAt   DateTime @default(now())
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerUid])
  @@index([userId])
}

model badges {
  id          String        @id
  type        BadgeType     @unique
  name        String
  description String
  criteria    String
  imageUrl    String?
  user_badges user_badges[]
}

model card_game_feedbacks {
  id                String              @id
  userId            String
  topicId           String
  sessionNumber     Int
  questionId        String
  rating            Int
  comment           String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  users             users               @relation(fields: [userId], references: [id], onDelete: Cascade)
  card_game_replies card_game_replies[]
  card_game_upvotes card_game_upvotes[]

  @@index([questionId])
  @@index([topicId])
  @@index([userId])
}

model card_game_replies {
  id                  String              @id
  userId              String
  feedbackId          String
  text                String
  createdAt           DateTime            @default(now())
  updatedAt           DateTime
  card_game_feedbacks card_game_feedbacks @relation(fields: [feedbackId], references: [id], onDelete: Cascade)
  users               users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([feedbackId])
  @@index([userId])
}

model card_game_stats {
  id            String   @id
  topicId       String   @unique
  totalSessions Int      @default(0)
  averageRating Float    @default(0)
  totalFeedback Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime

  @@index([topicId])
}

model card_game_upvotes {
  id                  String              @id
  userId              String
  feedbackId          String
  createdAt           DateTime            @default(now())
  card_game_feedbacks card_game_feedbacks @relation(fields: [feedbackId], references: [id], onDelete: Cascade)
  users               users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, feedbackId])
  @@index([feedbackId])
  @@index([userId])
}

model communities {
  id                String              @id
  name              String              @unique
  description       String?
  imageUrl          String?
  category          String?
  isVerified        Boolean             @default(false)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  createdById       String
  users             users               @relation(fields: [createdById], references: [id], onDelete: Cascade)
  community_members community_members[]
  events            events[]

  @@index([category])
  @@index([createdAt])
  @@index([name])
}

model community_members {
  id          String        @id
  role        CommunityRole @default(MEMBER)
  joinedAt    DateTime      @default(now())
  isApproved  Boolean       @default(false)
  userId      String
  communityId String
  communities communities   @relation(fields: [communityId], references: [id], onDelete: Cascade)
  users       users         @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, communityId])
  @@index([communityId])
  @@index([role])
  @@index([userId])
}

model connection_reviews {
  id                                         String           @id
  connectionId                               String
  reviewerId                                 String
  revieweeId                                 String
  rating                                     Int
  review                                     String?
  reviewType                                 String           @default("general")
  isPublic                                   Boolean          @default(true)
  isFeatured                                 Boolean          @default(false)
  isVerified                                 Boolean          @default(false)
  verificationSource                         String?
  helpfulCount                               Int              @default(0)
  createdAt                                  DateTime         @default(now())
  updatedAt                                  DateTime
  user_connections                           user_connections @relation(fields: [connectionId], references: [id], onDelete: Cascade)
  users_connection_reviews_revieweeIdTousers users            @relation("connection_reviews_revieweeIdTousers", fields: [revieweeId], references: [id], onDelete: Cascade)
  users_connection_reviews_reviewerIdTousers users            @relation("connection_reviews_reviewerIdTousers", fields: [reviewerId], references: [id], onDelete: Cascade)

  @@unique([connectionId, reviewerId])
  @@index([connectionId])
  @@index([createdAt])
  @@index([isPublic, isFeatured])
  @@index([rating])
  @@index([revieweeId])
  @@index([reviewerId])
}

model connection_stats {
  userId                  String   @id
  totalConnections        Int      @default(0)
  pendingRequests         Int      @default(0)
  sentRequests            Int      @default(0)
  professionalConnections Int      @default(0)
  friendConnections       Int      @default(0)
  familyConnections       Int      @default(0)
  mentorConnections       Int      @default(0)
  travelConnections       Int      @default(0)
  communityConnections    Int      @default(0)
  averageRating           Float?
  highestRating           Float?
  totalReviewsReceived    Int      @default(0)
  totalReviewsGiven       Int      @default(0)
  totalMutualFriends      Int      @default(0)
  trustChainDepth         Int      @default(1)
  connectionQuality       Float    @default(0.0)
  lastCalculatedAt        DateTime @default(now())
  createdAt               DateTime @default(now())
  updatedAt               DateTime
  users                   users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([averageRating])
  @@index([connectionQuality])
  @@index([totalConnections])
}

model device_registrations {
  id                String   @id
  userId            String
  deviceFingerprint String
  deviceName        String?
  deviceInfo        Json
  isTrusted         Boolean  @default(false)
  lastSeenAt        DateTime @default(now())
  createdAt         DateTime @default(now())
  users             users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, deviceFingerprint])
  @@index([userId])
}

model email_verification_tokens {
  id         String    @id
  userId     String
  email      String
  token      String    @unique
  expiresAt  DateTime
  verifiedAt DateTime?
  createdAt  DateTime  @default(now())
  users      users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model event_attendances {
  id          String   @id
  checkedInAt DateTime @default(now())
  userId      String
  eventId     String
  events      events   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, eventId])
  @@index([checkedInAt])
  @@index([eventId])
  @@index([userId])
}

model event_rsvps {
  id        String   @id
  qrCode    String   @unique
  createdAt DateTime @default(now())
  userId    String
  eventId   String
  events    events   @relation(fields: [eventId], references: [id], onDelete: Cascade)
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, eventId])
  @@index([createdAt])
  @@index([eventId])
  @@index([userId])
}

model event_ticket_tiers {
  id             String          @id
  eventId        String
  tierName       String
  description    String?
  price          Float
  currency       String          @default("MYR")
  totalQuantity  Int?
  soldQuantity   Int             @default(0)
  minPurchase    Int             @default(1)
  maxPurchase    Int             @default(10)
  availableFrom  DateTime?
  availableUntil DateTime?
  displayOrder   Int             @default(0)
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime
  events         events          @relation(fields: [eventId], references: [id], onDelete: Cascade)
  event_tickets  event_tickets[]

  @@index([availableFrom, availableUntil])
  @@index([eventId, isActive])
}

model event_tickets {
  id                   String                @id
  eventId              String
  userId               String
  ticketTierId         String?
  ticketType           String                @default("GENERAL")
  price                Float
  currency             String                @default("MYR")
  status               EventTicketStatus     @default(PENDING)
  paymentTransactionId String?
  paymentStatus        PaymentStatus         @default(PENDING)
  ticketNumber         String                @unique
  quantity             Int                   @default(1)
  purchasedAt          DateTime              @default(now())
  checkedInAt          DateTime?
  canceledAt           DateTime?
  refundedAt           DateTime?
  attendeeName         String?
  attendeeEmail        String?
  attendeePhone        String?
  events               events                @relation(fields: [eventId], references: [id], onDelete: Cascade)
  payment_transactions payment_transactions? @relation(fields: [paymentTransactionId], references: [id])
  event_ticket_tiers   event_ticket_tiers?   @relation(fields: [ticketTierId], references: [id])
  users                users                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, ticketNumber])
  @@index([eventId])
  @@index([paymentTransactionId])
  @@index([purchasedAt])
  @@index([status])
  @@index([ticketNumber])
  @@index([ticketTierId])
  @@index([userId])
  @@index([userId, status])
}

model events {
  id                 String               @id
  title              String
  description        String?
  type               EventType
  date               DateTime
  location           String
  mapLink            String?
  maxAttendees       Int?
  notes              String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  hostId             String
  communityId        String?
  currency           String               @default("MYR")
  hostType           EventHostType        @default(PERSONAL)
  images             String[]             @default([])
  isFree             Boolean              @default(true)
  organizerPayout    Float?               @default(0.0)
  platformFee        Float?               @default(0.0)
  price              Float?
  status             EventStatus          @default(DRAFT)
  ticketsSold        Int                  @default(0)
  totalRevenue       Float?               @default(0.0)
  event_attendances  event_attendances[]
  event_rsvps        event_rsvps[]
  event_ticket_tiers event_ticket_tiers[]
  event_tickets      event_tickets[]
  communities        communities?         @relation(fields: [communityId], references: [id])
  users              users                @relation(fields: [hostId], references: [id], onDelete: Cascade)

  @@index([communityId, date])
  @@index([communityId])
  @@index([createdAt])
  @@index([date])
  @@index([hostId, date])
  @@index([hostId])
  @@index([hostType])
  @@index([isFree])
  @@index([location])
  @@index([status])
  @@index([type, date])
  @@index([type])
}

model faq_analytics {
  id            String    @id
  faqId         String
  userId        String?
  viewed        Boolean   @default(false)
  viewedAt      DateTime?
  markedHelpful Boolean?
  markedAt      DateTime?
  searchQuery   String?
  viewedFrom    String?
  createdAt     DateTime  @default(now())
  faqs          faqs      @relation(fields: [faqId], references: [id], onDelete: Cascade)

  @@index([faqId, viewed])
  @@index([userId])
}

model faq_categories {
  id           String  @id
  name         String
  description  String?
  icon         String?
  displayOrder Int     @default(0)
  isActive     Boolean @default(true)
  faqs         faqs[]

  @@index([displayOrder, isActive])
}

model faqs {
  id                String          @id
  categoryId        String?
  question          String
  answer            String
  displayOrder      Int             @default(0)
  tags              String[]        @default([])
  isActive          Boolean         @default(true)
  isFeatured        Boolean         @default(false)
  viewCount         Int             @default(0)
  helpfulCount      Int             @default(0)
  notHelpfulCount   Int             @default(0)
  relatedFaqIds     String[]        @default([])
  relatedArticleIds String[]        @default([])
  createdAt         DateTime        @default(now())
  updatedAt         DateTime
  faq_analytics     faq_analytics[]
  faq_categories    faq_categories? @relation(fields: [categoryId], references: [id])

  @@index([categoryId, isActive])
  @@index([displayOrder])
  @@index([isFeatured, isActive])
}

model feature_flag_analytics {
  id            String        @id
  featureFlagId String
  userId        String?
  wasEnabled    Boolean
  evaluatedAt   DateTime      @default(now())
  variant       String?
  userSegment   String?
  platform      String?
  appVersion    String?
  featureUsed   Boolean       @default(false)
  usedAt        DateTime?
  usageCount    Int           @default(0)
  feature_flags feature_flags @relation(fields: [featureFlagId], references: [id], onDelete: Cascade)

  @@index([evaluatedAt])
  @@index([featureFlagId, wasEnabled])
  @@index([userId])
}

model feature_flags {
  id                     String                   @id
  featureKey             String                   @unique
  featureName            String
  description            String?
  isEnabled              Boolean                  @default(false)
  isGlobal               Boolean                  @default(false)
  rolloutPercentage      Float                    @default(0.0)
  rolloutStrategy        String                   @default("percentage")
  targetUserIds          String[]                 @default([])
  targetSegments         String[]                 @default([])
  targetCountries        String[]                 @default([])
  targetPlatforms        String[]                 @default([])
  minAppVersion          String?
  maxAppVersion          String?
  isABTest               Boolean                  @default(false)
  abTestVariant          String?
  abTestMetrics          Json?
  enabledAt              DateTime?
  disabledAt             DateTime?
  scheduledEnableAt      DateTime?
  scheduledDisableAt     DateTime?
  createdBy              String?
  tags                   String[]                 @default([])
  dependencies           String[]                 @default([])
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  feature_flag_analytics feature_flag_analytics[]

  @@index([featureKey, isEnabled])
  @@index([isEnabled, isGlobal])
}

model feature_usage {
  id             String   @id
  userId         String
  subscriptionId String?
  featureCode    String
  entityType     String
  entityId       String?
  usedAt         DateTime @default(now())
  periodStart    DateTime
  periodEnd      DateTime
  metadata       Json?
  users          users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([periodStart, periodEnd])
  @@index([subscriptionId, featureCode])
  @@index([usedAt])
  @@index([userId, featureCode])
}

model help_article_analytics {
  id               String        @id
  articleId        String
  userId           String?
  viewed           Boolean       @default(false)
  viewedAt         DateTime?
  markedHelpful    Boolean?
  markedAt         DateTime?
  timeSpentSeconds Int?
  scrollDepth      Float?
  viewedFrom       String?
  searchQuery      String?
  createdAt        DateTime      @default(now())
  help_articles    help_articles @relation(fields: [articleId], references: [id], onDelete: Cascade)

  @@index([articleId, viewed])
  @@index([userId])
}

model help_article_categories {
  id            String          @id
  name          String
  slug          String          @unique
  description   String?
  icon          String?
  displayOrder  Int             @default(0)
  isActive      Boolean         @default(true)
  help_articles help_articles[]

  @@index([displayOrder, isActive])
}

model help_articles {
  id                      String                   @id
  categoryId              String?
  title                   String
  slug                    String                   @unique
  content                 String
  excerpt                 String?
  thumbnailUrl            String?
  videoUrl                String?
  attachments             Json?
  displayOrder            Int                      @default(0)
  tags                    String[]                 @default([])
  metaDescription         String?
  keywords                String[]                 @default([])
  isActive                Boolean                  @default(true)
  isFeatured              Boolean                  @default(false)
  isPremiumOnly           Boolean                  @default(false)
  viewCount               Int                      @default(0)
  helpfulCount            Int                      @default(0)
  notHelpfulCount         Int                      @default(0)
  averageTimeSpent        Float?
  relatedArticleIds       String[]                 @default([])
  relatedFaqIds           String[]                 @default([])
  createdBy               String?
  publishedAt             DateTime?
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime
  help_article_analytics  help_article_analytics[]
  help_article_categories help_article_categories? @relation(fields: [categoryId], references: [id])

  @@index([categoryId, isActive])
  @@index([isFeatured, isActive])
  @@index([publishedAt])
  @@index([slug])
}

model legal_document_acceptances {
  id              String            @id
  documentId      String
  userId          String
  acceptedAt      DateTime          @default(now())
  ipAddress       String?
  userAgent       String?
  deviceInfo      Json?
  documentVersion String
  documentType    LegalDocumentType
  legal_documents legal_documents   @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@unique([userId, documentId])
  @@index([documentId])
  @@index([userId, documentType])
}

model legal_documents {
  id                         String                       @id
  documentType               LegalDocumentType
  version                    String
  title                      String
  content                    String
  summary                    String?
  effectiveDate              DateTime
  expiryDate                 DateTime?
  isActive                   Boolean                      @default(false)
  isCurrent                  Boolean                      @default(false)
  requiresAcceptance         Boolean                      @default(false)
  changesSummary             String?
  previousVersionId          String?
  createdBy                  String?
  approvedBy                 String?
  approvedAt                 DateTime?
  createdAt                  DateTime                     @default(now())
  updatedAt                  DateTime
  legal_document_acceptances legal_document_acceptances[]

  @@unique([documentType, version])
  @@index([documentType, isCurrent])
  @@index([effectiveDate])
}

model listing_price_history {
  id                   String               @id
  listingId            String
  price                Float
  currency             String               @default("MYR")
  reason               String?
  changedAt            DateTime             @default(now())
  marketplace_listings marketplace_listings @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([listingId, changedAt])
}

model login_attempts {
  id            String   @id
  userId        String?
  identifier    String
  ipAddress     String
  userAgent     String?
  success       Boolean
  failureReason String?
  attemptedAt   DateTime @default(now())
  users         users?   @relation(fields: [userId], references: [id])

  @@index([identifier, attemptedAt])
  @@index([ipAddress, attemptedAt])
  @@index([userId, attemptedAt])
}

model maintenance_schedules {
  id                String            @id
  title             String
  description       String
  startTime         DateTime
  endTime           DateTime
  estimatedDuration Int?
  status            MaintenanceStatus @default(SCHEDULED)
  affectedFeatures  String[]          @default([])
  isFullDowntime    Boolean           @default(false)
  severity          String            @default("medium")
  userMessage       String?
  technicalDetails  String?
  updates           Json?
  notifyUsers       Boolean           @default(true)
  notificationSent  Boolean           @default(false)
  notifiedAt        DateTime?
  actualStartTime   DateTime?
  actualEndTime     DateTime?
  completionNotes   String?
  createdBy         String?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime

  @@index([startTime, endTime])
  @@index([status, startTime])
}

model marketplace_cart_items {
  id                   String               @id
  userId               String
  listingId            String
  quantity             Int
  addedAt              DateTime             @default(now())
  marketplace_listings marketplace_listings @relation(fields: [listingId], references: [id], onDelete: Cascade)
  users                users                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listingId])
  @@index([userId])
}

model marketplace_disputes {
  id                 String             @id
  orderId            String
  initiatedBy        String
  reason             String
  status             DisputeStatus      @default(OPEN)
  resolution         Json?
  createdAt          DateTime           @default(now())
  resolvedAt         DateTime?
  users              users              @relation(fields: [initiatedBy], references: [id], onDelete: Cascade)
  marketplace_orders marketplace_orders @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([status])
}

model marketplace_listings {
  id                     String                   @id
  userId                 String
  title                  String
  description            String?
  category               String?
  price                  Float
  currency               String                   @default("MYR")
  quantity               Int?
  location               String?
  images                 String[]                 @default([])
  status                 ListingStatus            @default(DRAFT)
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  listing_price_history  listing_price_history[]
  marketplace_cart_items marketplace_cart_items[]
  users                  users                    @relation(fields: [userId], references: [id], onDelete: Cascade)
  marketplace_orders     marketplace_orders[]

  @@index([category])
  @@index([createdAt])
  @@index([status])
  @@index([userId, status])
}

model marketplace_orders {
  id                                       String                 @id
  listingId                                String
  buyerId                                  String
  sellerId                                 String
  quantity                                 Int
  unitPrice                                Float
  subtotal                                 Float
  shippingFee                              Float                  @default(0.0)
  totalAmount                              Float
  currency                                 String                 @default("MYR")
  paymentTransactionId                     String?
  paymentStatus                            PaymentStatus          @default(PENDING)
  platformFee                              Float?
  sellerPayout                             Float?
  status                                   OrderStatus            @default(PENDING)
  shippingAddress                          Json?
  trackingNumber                           String?
  notes                                    String?
  createdAt                                DateTime               @default(now())
  updatedAt                                DateTime
  confirmedAt                              DateTime?
  shippedAt                                DateTime?
  deliveredAt                              DateTime?
  canceledAt                               DateTime?
  marketplace_disputes                     marketplace_disputes[]
  users_marketplace_orders_buyerIdTousers  users                  @relation("marketplace_orders_buyerIdTousers", fields: [buyerId], references: [id], onDelete: Cascade)
  marketplace_listings                     marketplace_listings   @relation(fields: [listingId], references: [id], onDelete: Cascade)
  payment_transactions                     payment_transactions?  @relation(fields: [paymentTransactionId], references: [id])
  users_marketplace_orders_sellerIdTousers users                  @relation("marketplace_orders_sellerIdTousers", fields: [sellerId], references: [id], onDelete: Cascade)
  marketplace_reviews                      marketplace_reviews[]

  @@index([buyerId, status])
  @@index([createdAt])
  @@index([listingId])
  @@index([paymentStatus])
  @@index([paymentTransactionId])
  @@index([sellerId, status])
  @@index([status])
}

model marketplace_reviews {
  id                                          String             @id
  orderId                                     String
  reviewerId                                  String
  revieweeId                                  String
  rating                                      Int
  comment                                     String?
  createdAt                                   DateTime           @default(now())
  marketplace_orders                          marketplace_orders @relation(fields: [orderId], references: [id], onDelete: Cascade)
  users_marketplace_reviews_revieweeIdTousers users              @relation("marketplace_reviews_revieweeIdTousers", fields: [revieweeId], references: [id], onDelete: Cascade)
  users_marketplace_reviews_reviewerIdTousers users              @relation("marketplace_reviews_reviewerIdTousers", fields: [reviewerId], references: [id], onDelete: Cascade)

  @@unique([orderId, reviewerId])
  @@index([revieweeId, rating])
}

model matches {
  id                              String      @id
  type                            MatchType
  status                          MatchStatus @default(PENDING)
  compatibility                   Float
  reason                          String
  interests                       String[]
  availability                    Json?
  location                        String?
  message                         String?
  createdAt                       DateTime    @default(now())
  updatedAt                       DateTime
  expiresAt                       DateTime
  senderId                        String
  receiverId                      String
  users_matches_receiverIdTousers users       @relation("matches_receiverIdTousers", fields: [receiverId], references: [id], onDelete: Cascade)
  users_matches_senderIdTousers   users       @relation("matches_senderIdTousers", fields: [senderId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId, type])
  @@index([createdAt])
  @@index([expiresAt])
  @@index([receiverId])
  @@index([receiverId, status])
  @@index([senderId])
  @@index([senderId, status])
  @@index([status])
  @@index([type])
}

model messages {
  id                               String   @id
  content                          String
  isRead                           Boolean  @default(false)
  createdAt                        DateTime @default(now())
  senderId                         String
  receiverId                       String
  users_messages_receiverIdTousers users    @relation("messages_receiverIdTousers", fields: [receiverId], references: [id], onDelete: Cascade)
  users_messages_senderIdTousers   users    @relation("messages_senderIdTousers", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([isRead])
  @@index([receiverId])
  @@index([receiverId, isRead])
  @@index([senderId])
  @@index([senderId, receiverId])
}

model notification_preferences {
  userId       String   @id
  emailEnabled Boolean  @default(true)
  pushEnabled  Boolean  @default(true)
  smsEnabled   Boolean  @default(false)
  inAppEnabled Boolean  @default(true)
  preferences  Json     @default("{}")
  quietHours   Json?
  timezone     String   @default("Asia/Kuala_Lumpur")
  updatedAt    DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model notifications {
  id                String           @id
  type              NotificationType
  title             String
  message           String
  actionUrl         String?
  metadata          Json?
  createdAt         DateTime         @default(now())
  userId            String
  channels          String[]         @default([])
  deliveredAt       DateTime?
  expiresAt         DateTime?
  priority          String           @default("normal")
  readAt            DateTime?
  relatedEntityId   String?
  relatedEntityType String?
  scheduledFor      DateTime?
  users             users            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([priority])
  @@index([readAt])
  @@index([type])
  @@index([userId, createdAt])
  @@index([userId])
  @@index([userId, readAt])
}

model onboarding_analytics {
  id                 String             @id
  screenId           String
  userId             String?
  viewed             Boolean            @default(false)
  viewedAt           DateTime?
  completed          Boolean            @default(false)
  completedAt        DateTime?
  skipped            Boolean            @default(false)
  skippedAt          DateTime?
  timeSpentSeconds   Int?
  deviceInfo         Json?
  appVersion         String?
  createdAt          DateTime           @default(now())
  onboarding_screens onboarding_screens @relation(fields: [screenId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([screenId, viewed])
  @@index([userId])
}

model onboarding_screens {
  id                   String                 @id
  screenOrder          Int
  title                String
  subtitle             String?
  description          String?
  imageUrl             String?
  videoUrl             String?
  ctaText              String?
  ctaAction            String?
  ctaUrl               String?
  backgroundColor      String?
  isSkippable          Boolean                @default(true)
  isActive             Boolean                @default(true)
  targetAudience       String                 @default("all")
  minAppVersion        String?
  metadata             Json?
  createdAt            DateTime               @default(now())
  updatedAt            DateTime
  onboarding_analytics onboarding_analytics[]

  @@index([isActive])
  @@index([screenOrder, isActive])
}

model password_reset_tokens {
  id        String    @id
  userId    String
  token     String    @unique
  expiresAt DateTime
  usedAt    DateTime?
  ipAddress String
  createdAt DateTime  @default(now())
  users     users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
}

model payment_provider_routing {
  id                String            @id
  ruleName          String
  providerId        String
  conditions        Json
  priority          Int               @default(0)
  isActive          Boolean           @default(true)
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  payment_providers payment_providers @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([priority, isActive])
  @@index([providerId, isActive])
}

model payment_providers {
  id                       String                     @id
  providerCode             String                     @unique
  providerName             String
  providerType             String
  supportedCountries       String[]
  supportedCurrencies      String[]
  isActive                 Boolean                    @default(true)
  isDefault                Boolean                    @default(false)
  priorityOrder            Int                        @default(0)
  configuration            Json                       @default("{}")
  feeStructure             Json                       @default("{}")
  capabilities             Json                       @default("{}")
  webhookConfig            Json?
  createdAt                DateTime                   @default(now())
  updatedAt                DateTime
  payment_provider_routing payment_provider_routing[]
  payment_transactions     payment_transactions[]

  @@index([isActive, priorityOrder])
  @@index([providerCode])
}

model payment_transactions {
  id                     String                  @id
  userId                 String
  transactionType        TransactionType
  referenceType          String
  referenceId            String
  amount                 Float
  currency               String                  @default("MYR")
  totalFees              Float                   @default(0.0)
  platformFee            Float                   @default(0.0)
  gatewayFee             Float                   @default(0.0)
  netAmount              Float                   @default(0.0)
  providerId             String
  gatewayTransactionId   String                  @unique
  gatewayPaymentMethodId String?
  gatewayMetadata        Json?
  status                 PaymentStatus           @default(PENDING)
  failureReason          String?
  processedAt            DateTime?
  refundedAmount         Float?                  @default(0.0)
  refundedAt             DateTime?
  refundReason           String?
  description            String?
  metadata               Json?
  createdAt              DateTime                @default(now())
  updatedAt              DateTime
  event_tickets          event_tickets[]
  marketplace_orders     marketplace_orders[]
  payment_providers      payment_providers       @relation(fields: [providerId], references: [id])
  users                  users                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  payout_distributions   payout_distributions[]
  service_bookings       service_bookings[]
  subscription_payments  subscription_payments[]
  transaction_fees       transaction_fees[]

  @@index([createdAt])
  @@index([gatewayTransactionId])
  @@index([processedAt, status])
  @@index([providerId, status])
  @@index([referenceType, referenceId])
  @@index([transactionType])
  @@index([transactionType, status])
  @@index([userId, status])
}

model payout_distributions {
  id                   String               @id
  paymentTransactionId String
  recipientId          String
  recipientType        String
  amount               Float
  currency             String               @default("MYR")
  status               PayoutStatus         @default(PENDING)
  releaseDate          DateTime?
  gatewayPayoutId      String?
  createdAt            DateTime             @default(now())
  releasedAt           DateTime?
  payment_transactions payment_transactions @relation(fields: [paymentTransactionId], references: [id], onDelete: Cascade)
  users                users                @relation(fields: [recipientId], references: [id], onDelete: Cascade)

  @@index([paymentTransactionId])
  @@index([recipientId, status])
  @@index([releaseDate, status])
}

model platform_fee_configs {
  id               String             @id
  configName       String
  transactionType  TransactionType
  feePercentage    Float?
  feeFixed         Float?
  minFee           Float?
  maxFee           Float?
  currency         String             @default("MYR")
  conditions       Json               @default("{}")
  recipientType    String             @default("platform")
  recipientId      String?
  isActive         Boolean            @default(true)
  priority         Int                @default(0)
  effectiveFrom    DateTime           @default(now())
  effectiveUntil   DateTime?
  description      String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  transaction_fees transaction_fees[]

  @@index([effectiveFrom, effectiveUntil])
  @@index([priority, isActive])
  @@index([transactionType, isActive])
}

model point_histories {
  id          String   @id
  points      Int
  action      String
  description String?
  createdAt   DateTime @default(now())
  userId      String
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([action])
  @@index([createdAt])
  @@index([userId, createdAt])
  @@index([userId])
}

model profile_completion_status {
  userId              String    @id
  completionScore     Float     @default(0.0)
  completionLevel     String    @default("starter")
  hasProfilePicture   Boolean   @default(false)
  hasDisplayName      Boolean   @default(false)
  hasBio              Boolean   @default(false)
  hasLocation         Boolean   @default(false)
  hasInterests        Boolean   @default(false)
  hasLanguages        Boolean   @default(false)
  hasProfession       Boolean   @default(false)
  hasDateOfBirth      Boolean   @default(false)
  hasSocialHandles    Boolean   @default(false)
  hasVerifiedEmail    Boolean   @default(false)
  hasVerifiedPhone    Boolean   @default(false)
  fieldWeights        Json      @default("{}")
  missingFields       String[]  @default([])
  nextRecommendation  String?
  reachedBasic        Boolean   @default(false)
  reachedIntermediate Boolean   @default(false)
  reachedComplete     Boolean   @default(false)
  reachedExpert       Boolean   @default(false)
  pointsEarned        Int       @default(0)
  badgesUnlocked      String[]  @default([])
  lastCalculatedAt    DateTime  @default(now())
  firstCompleteAt     DateTime?
  createdAt           DateTime  @default(now())
  updatedAt           DateTime
  users               users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([completionLevel])
  @@index([completionScore])
  @@index([lastCalculatedAt])
}

model push_subscriptions {
  id        String   @id
  userId    String   @unique
  endpoint  String
  p256dh    String
  auth      String
  createdAt DateTime @default(now())
  updatedAt DateTime
  users     users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
}

model redemptions {
  id          String           @id
  status      RedemptionStatus @default(PENDING)
  notes       String?
  redeemedAt  DateTime         @default(now())
  processedAt DateTime?
  userId      String
  rewardId    String
  rewards     rewards          @relation(fields: [rewardId], references: [id], onDelete: Cascade)
  users       users            @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([rewardId])
  @@index([status])
  @@index([userId])
}

model referral_campaigns {
  id                   String      @id
  campaignCode         String      @unique
  campaignName         String
  description          String?
  referrerRewardType   String      @default("points")
  referrerRewardAmount Float       @default(100.0)
  refereeRewardType    String      @default("points")
  refereeRewardAmount  Float       @default(50.0)
  bonusRewards         Json?
  activationCriteria   Json        @default("{}")
  startDate            DateTime
  endDate              DateTime?
  maxReferrals         Int?
  maxPerUser           Int?
  targetCountries      String[]    @default([])
  targetUserSegment    String?
  isActive             Boolean     @default(true)
  isPaused             Boolean     @default(false)
  totalReferrals       Int         @default(0)
  totalSignups         Int         @default(0)
  totalActivated       Int         @default(0)
  totalRewardsGiven    Float       @default(0.0)
  createdAt            DateTime    @default(now())
  updatedAt            DateTime
  referrals            referrals[]

  @@index([campaignCode, isActive])
  @@index([isActive, isPaused])
  @@index([startDate, endDate])
}

model referral_rewards {
  id                String               @id
  referralId        String
  userId            String
  rewardType        String
  rewardAmount      Float?
  rewardDuration    Int?
  description       String
  status            ReferralRewardStatus @default(PENDING)
  isMilestoneReward Boolean              @default(false)
  milestoneCount    Int?
  awardedAt         DateTime?
  expiresAt         DateTime?
  claimedAt         DateTime?
  metadata          Json?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime
  referrals         referrals            @relation(fields: [referralId], references: [id], onDelete: Cascade)
  users             users                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([awardedAt])
  @@index([isMilestoneReward])
  @@index([referralId])
  @@index([status])
  @@index([userId, status])
}

model referral_stats {
  userId                String    @id
  totalReferrals        Int       @default(0)
  totalClicks           Int       @default(0)
  totalSignups          Int       @default(0)
  totalActivated        Int       @default(0)
  clickToSignupRate     Float     @default(0.0)
  signupToActiveRate    Float     @default(0.0)
  overallConversionRate Float     @default(0.0)
  totalPointsEarned     Int       @default(0)
  totalCreditsEarned    Float     @default(0.0)
  totalRewardsCount     Int       @default(0)
  milestonesReached     Json      @default("[]")
  bestConversionMonth   String?
  bestConversionCount   Int       @default(0)
  currentStreak         Int       @default(0)
  longestStreak         Int       @default(0)
  leaderboardRank       Int?
  topReferrerBadge      Boolean   @default(false)
  lastReferralAt        DateTime?
  lastActivationAt      DateTime?
  lastCalculatedAt      DateTime  @default(now())
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  users                 users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([leaderboardRank])
  @@index([topReferrerBadge])
  @@index([totalActivated])
  @@index([totalPointsEarned])
}

model referrals {
  id                                String              @id
  referrerId                        String
  refereeId                         String?
  referralCode                      String              @unique
  referralMethod                    String?
  referralSource                    String?
  campaignId                        String?
  clickedAt                         DateTime?
  signedUpAt                        DateTime?
  activatedAt                       DateTime?
  expiredAt                         DateTime?
  isActivated                       Boolean             @default(false)
  activationCriteria                Json?
  referrerRewardGiven               Boolean             @default(false)
  refereeRewardGiven                Boolean             @default(false)
  ipAddress                         String?
  userAgent                         String?
  deviceInfo                        Json?
  metadata                          Json?
  notes                             String?
  createdAt                         DateTime            @default(now())
  updatedAt                         DateTime
  referral_rewards                  referral_rewards[]
  referral_campaigns                referral_campaigns? @relation(fields: [campaignId], references: [id])
  users_referrals_refereeIdTousers  users?              @relation("referrals_refereeIdTousers", fields: [refereeId], references: [id])
  users_referrals_referrerIdTousers users               @relation("referrals_referrerIdTousers", fields: [referrerId], references: [id], onDelete: Cascade)

  @@index([activatedAt])
  @@index([campaignId])
  @@index([createdAt])
  @@index([isActivated])
  @@index([refereeId])
  @@index([referralCode])
  @@index([referrerId, isActivated])
  @@index([signedUpAt])
}

model refresh_tokens {
  id          String   @id
  tokenHash   String   @unique
  tokenFamily String
  userId      String
  isRevoked   Boolean  @default(false)
  expiresAt   DateTime
  createdAt   DateTime @default(now())
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([tokenHash])
  @@index([userId])
}

model rewards {
  id             String        @id
  title          String
  description    String
  pointsRequired Int
  category       String
  partner        String
  quantity       Int           @default(0)
  imageUrl       String?
  isActive       Boolean       @default(true)
  createdAt      DateTime      @default(now())
  updatedAt      DateTime
  redemptions    redemptions[]

  @@index([category])
  @@index([isActive])
}

model security_events {
  id          String   @id
  userId      String
  eventType   String
  severity    String   @default("medium")
  description String
  metadata    Json?
  ipAddress   String?
  userAgent   String?
  createdAt   DateTime @default(now())
  users       users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([eventType])
  @@index([severity])
  @@index([userId, createdAt])
}

model service_bookings {
  id                                       String                @id
  serviceId                                String
  customerId                               String
  providerId                               String
  bookingType                              ServiceType
  startDate                                DateTime
  endDate                                  DateTime
  guestsCount                              Int                   @default(1)
  baseAmount                               Float
  additionalFees                           Float                 @default(0.0)
  totalAmount                              Float
  currency                                 String                @default("MYR")
  paymentTransactionId                     String?
  paymentStatus                            PaymentStatus         @default(PENDING)
  platformFee                              Float?
  providerPayout                           Float?
  status                                   BookingStatus         @default(PENDING)
  specialRequests                          String?
  bookingDetails                           Json?
  createdAt                                DateTime              @default(now())
  updatedAt                                DateTime
  confirmedAt                              DateTime?
  completedAt                              DateTime?
  canceledAt                               DateTime?
  users_service_bookings_customerIdTousers users                 @relation("service_bookings_customerIdTousers", fields: [customerId], references: [id], onDelete: Cascade)
  payment_transactions                     payment_transactions? @relation(fields: [paymentTransactionId], references: [id])
  users_service_bookings_providerIdTousers users                 @relation("service_bookings_providerIdTousers", fields: [providerId], references: [id], onDelete: Cascade)
  services                                 services              @relation(fields: [serviceId], references: [id], onDelete: Cascade)

  @@index([customerId, status])
  @@index([paymentStatus])
  @@index([paymentTransactionId])
  @@index([providerId, status])
  @@index([serviceId])
  @@index([startDate, endDate])
  @@index([status])
}

model services {
  id               String             @id
  providerId       String
  title            String
  description      String?
  serviceType      ServiceType
  category         String?
  pricingType      PricingType
  basePrice        Float
  currency         String             @default("MYR")
  maxGuests        Int?
  location         String?
  availability     Json?
  requirements     Json?
  images           String[]           @default([])
  status           ServiceStatus      @default(DRAFT)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  service_bookings service_bookings[]
  users            users              @relation(fields: [providerId], references: [id], onDelete: Cascade)

  @@index([providerId, status])
  @@index([serviceType, status])
  @@index([status])
}

model subscription_payments {
  id                   String                @id
  subscriptionId       String
  userId               String
  amount               Float
  currency             String                @default("MYR")
  billingPeriodStart   DateTime
  billingPeriodEnd     DateTime
  status               PaymentStatus         @default(PENDING)
  attemptCount         Int                   @default(1)
  paymentTransactionId String?
  gatewayInvoiceId     String?
  dueDate              DateTime
  paidAt               DateTime?
  failedAt             DateTime?
  failureReason        String?
  createdAt            DateTime              @default(now())
  payment_transactions payment_transactions? @relation(fields: [paymentTransactionId], references: [id])
  user_subscriptions   user_subscriptions    @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  users                users                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([dueDate])
  @@index([paymentTransactionId])
  @@index([status])
  @@index([subscriptionId, status])
  @@index([userId, status])
}

model subscription_tiers {
  id                 String               @id
  tierCode           String               @unique
  tierName           String
  description        String?
  price              Float                @default(0.0)
  currency           String               @default("MYR")
  billingCycle       String               @default("MONTHLY")
  features           Json                 @default("{}")
  displayOrder       Int                  @default(0)
  isActive           Boolean              @default(true)
  isPublic           Boolean              @default(true)
  trialDays          Int?                 @default(0)
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  user_subscriptions user_subscriptions[]

  @@index([displayOrder])
  @@index([isActive, isPublic])
  @@index([tierCode, isActive])
}

model transaction_fees {
  id                   String                @id
  transactionId        String
  feeConfigId          String?
  feeType              String
  feePercentage        Float?
  feeFixed             Float?
  calculatedFee        Float
  recipientType        String
  recipientId          String?
  currency             String                @default("MYR")
  description          String?
  appliedAt            DateTime              @default(now())
  platform_fee_configs platform_fee_configs? @relation(fields: [feeConfigId], references: [id])
  payment_transactions payment_transactions  @relation(fields: [transactionId], references: [id], onDelete: Cascade)

  @@index([feeConfigId])
  @@index([recipientType, recipientId])
  @@index([transactionId, feeType])
}

model travel_bucket_list {
  id                String    @id
  userId            String
  country           String
  city              String?
  destination       String
  description       String?
  priority          String    @default("medium")
  targetYear        Int?
  estimatedBudget   Float?
  status            String    @default("planning")
  visitedDate       DateTime?
  isPublic          Boolean   @default(true)
  seekingCompanions Boolean   @default(false)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime

  @@index([country])
  @@index([seekingCompanions])
  @@index([userId, status])
}

model travel_companions {
  id                                         String       @id
  tripId                                     String
  userId                                     String
  companionId                                String?
  companionName                              String?
  companionEmail                             String?
  companionPhone                             String?
  invitationStatus                           String       @default("pending")
  canRequestIntro                            Boolean      @default(true)
  relationship                               String?
  notes                                      String?
  hasVouched                                 Boolean      @default(false)
  vouchId                                    String?
  addedAt                                    DateTime     @default(now())
  verifiedAt                                 DateTime?
  users_travel_companions_companionIdTousers users?       @relation("travel_companions_companionIdTousers", fields: [companionId], references: [id])
  travel_trips                               travel_trips @relation(fields: [tripId], references: [id], onDelete: Cascade)
  users_travel_companions_userIdTousers      users        @relation("travel_companions_userIdTousers", fields: [userId], references: [id], onDelete: Cascade)

  @@index([companionId])
  @@index([invitationStatus])
  @@index([tripId])
  @@index([userId])
}

model travel_highlights {
  id            String       @id
  tripId        String
  title         String
  description   String?
  highlightType String
  image         String?
  date          DateTime?
  location      String?
  createdAt     DateTime     @default(now())
  travel_trips  travel_trips @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@index([highlightType])
  @@index([tripId])
}

model travel_locations {
  id             String       @id
  tripId         String
  country        String
  city           String
  placeName      String?
  placeType      String?
  visitDate      DateTime?
  duration       Int?
  rating         Int?
  notes          String?
  wouldRecommend Boolean      @default(true)
  tips           String?
  images         String[]     @default([])
  latitude       Float?
  longitude      Float?
  createdAt      DateTime     @default(now())
  travel_trips   travel_trips @relation(fields: [tripId], references: [id], onDelete: Cascade)

  @@index([country, city])
  @@index([placeType])
  @@index([tripId])
}

model travel_stats {
  userId                String    @id
  totalTrips            Int       @default(0)
  countriesVisited      Int       @default(0)
  citiesVisited         Int       @default(0)
  continentsVisited     Int       @default(0)
  totalTravelDays       Int       @default(0)
  countriesList         String[]  @default([])
  continentsList        String[]  @default([])
  travelCompanionsCount Int       @default(0)
  soloTripsCount        Int       @default(0)
  firstTripDate         DateTime?
  lastTripDate          DateTime?
  favoriteDestination   String?
  travelFrequency       String?
  averageTripDuration   Int?
  lastCalculatedAt      DateTime  @default(now())
  createdAt             DateTime  @default(now())
  updatedAt             DateTime
  users                 users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([countriesVisited])
  @@index([totalTrips])
}

model travel_trips {
  id                String              @id
  userId            String
  title             String
  description       String?
  purpose           String?
  countries         String[]            @default([])
  cities            String[]            @default([])
  startDate         DateTime
  endDate           DateTime?
  duration          Int?
  coverImage        String?
  images            String[]            @default([])
  isPublic          Boolean             @default(true)
  isFeatured        Boolean             @default(false)
  tags              String[]            @default([])
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  travel_companions travel_companions[]
  travel_highlights travel_highlights[]
  travel_locations  travel_locations[]
  users             users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([countries])
  @@index([startDate])
  @@index([userId, isPublic])
  @@index([userId, startDate])
}

model user_activities {
  id           String   @id
  userId       String
  activityType String
  entityType   String
  entityId     String
  visibility   String   @default("public")
  createdAt    DateTime @default(now())
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([activityType])
  @@index([userId, createdAt])
}

model user_badges {
  id       String   @id
  earnedAt DateTime @default(now())
  userId   String
  badgeId  String
  badges   badges   @relation(fields: [badgeId], references: [id], onDelete: Cascade)
  users    users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
  @@index([userId])
}

model user_blocks {
  id                                 String   @id
  blockerId                          String
  blockedId                          String
  reason                             String?
  blockedAt                          DateTime @default(now())
  users_user_blocks_blockedIdTousers users    @relation("user_blocks_blockedIdTousers", fields: [blockedId], references: [id], onDelete: Cascade)
  users_user_blocks_blockerIdTousers users    @relation("user_blocks_blockerIdTousers", fields: [blockerId], references: [id], onDelete: Cascade)

  @@unique([blockerId, blockedId])
  @@index([blockedId])
  @@index([blockerId])
}

model user_connections {
  id                                        String               @id
  initiatorId                               String
  receiverId                                String
  status                                    ConnectionStatus     @default(PENDING)
  message                                   String?
  relationshipType                          String?
  relationshipCategory                      String?
  howWeMet                                  String?
  trustStrength                             Float                @default(0.0)
  interactionCount                          Int                  @default(0)
  lastInteraction                           DateTime?
  badges                                    String[]             @default([])
  tags                                      String[]             @default([])
  mutualFriendsCount                        Int                  @default(0)
  mutualCommunitiesCount                    Int                  @default(0)
  createdAt                                 DateTime             @default(now())
  respondedAt                               DateTime?
  connectedAt                               DateTime?
  removedAt                                 DateTime?
  removedBy                                 String?
  canReconnectAt                            DateTime?
  connection_reviews                        connection_reviews[]
  users_user_connections_initiatorIdTousers users                @relation("user_connections_initiatorIdTousers", fields: [initiatorId], references: [id], onDelete: Cascade)
  users_user_connections_receiverIdTousers  users                @relation("user_connections_receiverIdTousers", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([initiatorId, receiverId])
  @@index([badges])
  @@index([canReconnectAt])
  @@index([initiatorId])
  @@index([initiatorId, status])
  @@index([receiverId])
  @@index([receiverId, status])
  @@index([relationshipCategory])
  @@index([status])
  @@index([trustStrength])
}

model user_locations {
  userId             String    @id
  currentCity        String?
  countryOfResidence String?
  currentLocation    String?
  nationality        String?
  originallyFrom     String?
  timezone           String    @default("Asia/Kuala_Lumpur")
  preferredLanguage  String    @default("en")
  currency           String    @default("MYR")
  updatedAt          DateTime
  lastLocationUpdate DateTime?
  latitude           Float?
  longitude          Float?
  users              users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([countryOfResidence])
  @@index([currentCity])
  @@index([latitude, longitude])
  @@index([timezone])
}

model user_metadata {
  userId         String   @id
  referralCode   String   @unique
  membershipId   String?  @unique
  referralSource String?
  utmSource      String?
  utmMedium      String?
  utmCampaign    String?
  affiliateId    String?
  lifetimeValue  Float    @default(0.0)
  ipAddress      String?
  userAgent      String?
  tags           String[] @default([])
  notes          String?
  internalNotes  String?
  updatedAt      DateTime
  users          users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([affiliateId])
  @@index([referralSource])
}

model user_payment_methods {
  id              String    @id
  userId          String
  provider        String
  gatewayMethodId String
  type            String
  lastFour        String?
  brand           String?
  expiresAt       DateTime?
  isDefault       Boolean   @default(false)
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  users           users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, isDefault])
}

model user_preferences {
  userId                     String   @id
  darkMode                   Boolean  @default(false)
  googleCalendarConnected    Boolean  @default(false)
  googleCalendarRefreshToken String?
  pushToken                  String?
  preferences                Json     @default("{}")
  updatedAt                  DateTime
  users                      users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model user_privacy {
  userId                  String    @id
  profileVisibility       String    @default("public")
  searchableByPhone       Boolean   @default(true)
  searchableByEmail       Boolean   @default(true)
  allowDirectMessages     Boolean   @default(true)
  consentToDataProcessing Boolean   @default(true)
  consentToMarketing      Boolean   @default(false)
  consentDate             DateTime?
  deletionRequestedAt     DateTime?
  deletionScheduledFor    DateTime?
  dataExportRequestedAt   DateTime?
  updatedAt               DateTime
  users                   users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([deletionRequestedAt])
  @@index([profileVisibility])
}

model user_profiles {
  userId           String    @id
  displayName      String?
  profilePicture   String?
  bio              String?
  shortBio         String?
  dateOfBirth      DateTime?
  gender           String?
  age              Int?
  profession       String?
  occupation       String?
  website          String?
  personalityType  String?
  interests        String[]  @default([])
  languages        String[]  @default([])
  instagramHandle  String?
  linkedinHandle   String?
  travelStyle      String?
  bucketList       String[]  @default([])
  travelBio        String?
  customFields     Json?
  locationPrivacy  String    @default("friends") // "public", "friends", "private"
  updatedAt        DateTime
  users            users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([displayName])
}

model user_security {
  userId               String    @id
  emailVerifiedAt      DateTime?
  phoneVerifiedAt      DateTime?
  lastSeenAt           DateTime?
  lastLoginAt          DateTime?
  lastLoginLocation    String?
  lastPasswordChangeAt DateTime?
  mfaEnabled           Boolean   @default(false)
  mfaSecret            String?
  mfaRecoveryEmail     String?
  lastMfaAuthAt        DateTime?
  mfaBackupCodes       String[]  @default([])
  accountLockedReason  String?
  lockoutUntil         DateTime?
  suspendedUntil       DateTime?
  suspensionReason     String?
  updatedAt            DateTime
  users                users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([emailVerifiedAt])
  @@index([lastLoginAt])
  @@index([mfaEnabled])
  @@index([phoneVerifiedAt])
}

model user_service_profiles {
  userId           String   @id
  isHostAvailable  Boolean  @default(false)
  isGuideAvailable Boolean  @default(false)
  isHostCertified  Boolean  @default(false)
  hostDescription  String?
  guideDescription String?
  servicesOffered  Json?
  updatedAt        DateTime
  users            users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isGuideAvailable])
  @@index([isHostAvailable])
  @@index([isHostCertified])
}

model user_sessions {
  id             String   @id
  userId         String
  sessionToken   String   @unique
  deviceInfo     Json?
  ipAddress      String
  userAgent      String?
  locationData   Json?
  isActive       Boolean  @default(true)
  lastActivityAt DateTime @default(now())
  expiresAt      DateTime
  createdAt      DateTime @default(now())
  users          users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([sessionToken])
  @@index([userId, isActive])
}

model user_stats {
  userId            String   @id
  eventsAttended    Int      @default(0)
  eventsHosted      Int      @default(0)
  vouchesGiven      Int      @default(0)
  vouchesReceived   Int      @default(0)
  listingsPosted    Int      @default(0)
  servicesProvided  Int      @default(0)
  communitiesJoined Int      @default(0)
  totalPoints       Int      @default(0)
  lastCalculatedAt  DateTime @default(now())
  users             users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([eventsAttended])
  @@index([totalPoints])
}

model user_subscriptions {
  id                    String                  @id
  userId                String
  tierId                String
  status                SubscriptionStatus      @default(ACTIVE)
  currentPeriodStart    DateTime
  currentPeriodEnd      DateTime
  cancelAt              DateTime?
  canceledAt            DateTime?
  trialStart            DateTime?
  trialEnd              DateTime?
  paymentProviderId     String?
  gatewaySubscriptionId String?
  usageData             Json                    @default("{}")
  createdAt             DateTime                @default(now())
  updatedAt             DateTime
  subscription_payments subscription_payments[]
  subscription_tiers    subscription_tiers      @relation(fields: [tierId], references: [id])
  users                 users                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([currentPeriodEnd])
  @@index([gatewaySubscriptionId])
  @@index([status])
  @@index([tierId, status])
  @@index([userId, status])
}

model users {
  id                                                        String                      @id
  email                                                     String?                     @unique
  phone                                                     String?                     @unique
  password                                                  String?
  fullName                                                  String
  role                                                      UserRole                    @default(GENERAL_USER)
  totalPoints                                               Int                         @default(0)
  createdAt                                                 DateTime                    @default(now())
  updatedAt                                                 DateTime
  referredById                                              String?
  username                                                  String?                     @unique
  deletedAt                                                 DateTime?
  status                                                    UserStatus                  @default(ACTIVE)
  trustLevel                                                String                      @default("starter")
  trustScore                                                Float                       @default(0.0)
  auth_identities                                           auth_identities[]
  card_game_feedbacks                                       card_game_feedbacks[]
  card_game_replies                                         card_game_replies[]
  card_game_upvotes                                         card_game_upvotes[]
  communities                                               communities[]
  community_members                                         community_members[]
  connection_reviews_connection_reviews_revieweeIdTousers   connection_reviews[]        @relation("connection_reviews_revieweeIdTousers")
  connection_reviews_connection_reviews_reviewerIdTousers   connection_reviews[]        @relation("connection_reviews_reviewerIdTousers")
  connection_stats                                          connection_stats?
  device_registrations                                      device_registrations[]
  email_verification_tokens                                 email_verification_tokens[]
  event_attendances                                         event_attendances[]
  event_rsvps                                               event_rsvps[]
  event_tickets                                             event_tickets[]
  events                                                    events[]
  feature_usage                                             feature_usage[]
  login_attempts                                            login_attempts[]
  marketplace_cart_items                                    marketplace_cart_items[]
  marketplace_disputes                                      marketplace_disputes[]
  marketplace_listings                                      marketplace_listings[]
  marketplace_orders_marketplace_orders_buyerIdTousers      marketplace_orders[]        @relation("marketplace_orders_buyerIdTousers")
  marketplace_orders_marketplace_orders_sellerIdTousers     marketplace_orders[]        @relation("marketplace_orders_sellerIdTousers")
  marketplace_reviews_marketplace_reviews_revieweeIdTousers marketplace_reviews[]       @relation("marketplace_reviews_revieweeIdTousers")
  marketplace_reviews_marketplace_reviews_reviewerIdTousers marketplace_reviews[]       @relation("marketplace_reviews_reviewerIdTousers")
  matches_matches_receiverIdTousers                         matches[]                   @relation("matches_receiverIdTousers")
  matches_matches_senderIdTousers                           matches[]                   @relation("matches_senderIdTousers")
  messages_messages_receiverIdTousers                       messages[]                  @relation("messages_receiverIdTousers")
  messages_messages_senderIdTousers                         messages[]                  @relation("messages_senderIdTousers")
  notification_preferences                                  notification_preferences?
  notifications                                             notifications[]
  password_reset_tokens                                     password_reset_tokens[]
  payment_transactions                                      payment_transactions[]
  payout_distributions                                      payout_distributions[]
  point_histories                                           point_histories[]
  profile_completion_status                                 profile_completion_status?
  push_subscriptions                                        push_subscriptions?
  redemptions                                               redemptions[]
  referral_rewards                                          referral_rewards[]
  referral_stats                                            referral_stats?
  referrals_referrals_refereeIdTousers                      referrals[]                 @relation("referrals_refereeIdTousers")
  referrals_referrals_referrerIdTousers                     referrals[]                 @relation("referrals_referrerIdTousers")
  refresh_tokens                                            refresh_tokens[]
  security_events                                           security_events[]
  service_bookings_service_bookings_customerIdTousers       service_bookings[]          @relation("service_bookings_customerIdTousers")
  service_bookings_service_bookings_providerIdTousers       service_bookings[]          @relation("service_bookings_providerIdTousers")
  services                                                  services[]
  subscription_payments                                     subscription_payments[]
  travel_companions_travel_companions_companionIdTousers    travel_companions[]         @relation("travel_companions_companionIdTousers")
  travel_companions_travel_companions_userIdTousers         travel_companions[]         @relation("travel_companions_userIdTousers")
  travel_stats                                              travel_stats?
  travel_trips                                              travel_trips[]
  user_activities                                           user_activities[]
  user_badges                                               user_badges[]
  user_blocks_user_blocks_blockedIdTousers                  user_blocks[]               @relation("user_blocks_blockedIdTousers")
  user_blocks_user_blocks_blockerIdTousers                  user_blocks[]               @relation("user_blocks_blockerIdTousers")
  user_connections_user_connections_initiatorIdTousers      user_connections[]          @relation("user_connections_initiatorIdTousers")
  user_connections_user_connections_receiverIdTousers       user_connections[]          @relation("user_connections_receiverIdTousers")
  user_locations                                            user_locations?
  user_metadata                                             user_metadata?
  user_payment_methods                                      user_payment_methods[]
  user_preferences                                          user_preferences?
  user_privacy                                              user_privacy?
  user_profiles                                             user_profiles?
  user_security                                             user_security?
  user_service_profiles                                     user_service_profiles?
  user_sessions                                             user_sessions[]
  user_stats                                                user_stats?
  user_subscriptions                                        user_subscriptions[]
  users                                                     users?                      @relation("usersTousers", fields: [referredById], references: [id])
  other_users                                               users[]                     @relation("usersTousers")
  vouches_vouches_voucheeIdTousers                          vouches[]                   @relation("vouches_voucheeIdTousers")
  vouches_vouches_voucherIdTousers                          vouches[]                   @relation("vouches_voucherIdTousers")

  @@index([createdAt])
  @@index([deletedAt])
  @@index([email])
  @@index([phone])
  @@index([referredById])
  @@index([role])
  @@index([status])
  @@index([totalPoints])
  @@index([trustLevel])
  @@index([trustScore])
  @@index([username])
}

model vouch_configs {
  id                             String    @id
  maxPrimaryVouches              Int       @default(1)
  maxSecondaryVouches            Int       @default(3)
  maxCommunityVouches            Int       @default(2)
  primaryVouchWeight             Float     @default(30.0)
  secondaryVouchWeight           Float     @default(30.0)
  communityVouchWeight           Float     @default(40.0)
  trustMomentsWeight             Float     @default(30.0)
  activityWeight                 Float     @default(30.0)
  cooldownDays                   Int       @default(30)
  minTrustRequired               Float     @default(50.0)
  autoVouchMinEvents             Int       @default(5)
  autoVouchMinMemberDays         Int       @default(90)
  autoVouchRequireZeroNegativity Boolean   @default(true)
  reconnectionCooldownDays       Int       @default(30)
  perTier                        Json?
  effectiveFrom                  DateTime?
  createdAt                      DateTime  @default(now())
  updatedAt                      DateTime

  @@index([effectiveFrom])
}

model vouches {
  id                             String      @id
  voucherId                      String
  voucheeId                      String
  vouchType                      VouchType   @default(PRIMARY)
  weightPercentage               Float       @default(1.0)
  message                        String?
  status                         VouchStatus @default(PENDING)
  requiresApproval               Boolean     @default(true)
  isCommunityVouch               Boolean     @default(false)
  communityId                    String?
  vouchedByAdminId               String?
  isAutoVouched                  Boolean     @default(false)
  autoVouchCriteria              Json?
  requestedAt                    DateTime    @default(now())
  approvedAt                     DateTime?
  activatedAt                    DateTime?
  revokedAt                      DateTime?
  revokeReason                   String?
  trustImpact                    Float?
  createdAt                      DateTime    @default(now())
  updatedAt                      DateTime
  users_vouches_voucheeIdTousers users       @relation("vouches_voucheeIdTousers", fields: [voucheeId], references: [id], onDelete: Cascade)
  users_vouches_voucherIdTousers users       @relation("vouches_voucherIdTousers", fields: [voucherId], references: [id], onDelete: Cascade)

  @@unique([voucherId, voucheeId, vouchType])
  @@index([communityId, status])
  @@index([createdAt])
  @@index([isCommunityVouch])
  @@index([voucheeId, status])
  @@index([voucherId, status])
}

enum AnnouncementPriority {
  LOW
  NORMAL
  HIGH
  URGENT
}

enum AppNoticeType {
  INFO
  WARNING
  ERROR
  SUCCESS
  PROMOTION
  UPDATE
}

enum AppPlatform {
  IOS
  ANDROID
  WEB
}

enum BadgeType {
  FIRST_FACE
  CAFE_FRIEND
  SUKAN_SQUAD_MVP
  SOUL_NOURISHER
  HELPERS_HAND
  CONNECTOR
  TOP_FRIEND
  ICEBREAKER
  CERTIFIED_HOST
  STREAK_CHAMP
  LOCAL_GUIDE
  KIND_SOUL
  KNOWLEDGE_SHARER
  ALL_ROUNDER
}

enum BookingStatus {
  PENDING
  CONFIRMED
  ACTIVE
  COMPLETED
  CANCELED
  REFUNDED
}

enum CommunityRole {
  MEMBER
  MODERATOR
  ADMIN
  OWNER
}

enum ConnectionStatus {
  PENDING
  ACCEPTED
  REJECTED
  CANCELED
  REMOVED
}

enum DisputeStatus {
  OPEN
  UNDER_REVIEW
  RESOLVED
  CLOSED
}

enum EventHostType {
  PERSONAL
  COMMUNITY
}

enum EventStatus {
  DRAFT
  PUBLISHED
  CANCELED
  COMPLETED
}

enum EventTicketStatus {
  PENDING
  CONFIRMED
  CHECKED_IN
  CANCELED
  REFUNDED
  EXPIRED
}

enum EventType {
  SOCIAL
  SPORTS
  TRIP
  ILM
  CAFE_MEETUP
  VOLUNTEER
  MONTHLY_EVENT
  LOCAL_TRIP
}

enum LegalDocumentType {
  TOS
  PRIVACY_POLICY
  EULA
  COOKIE_POLICY
  COMMUNITY_GUIDELINES
  REFUND_POLICY
  ACCEPTABLE_USE
}

enum ListingStatus {
  DRAFT
  ACTIVE
  SOLD
  EXPIRED
  REMOVED
}

enum MaintenanceStatus {
  SCHEDULED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  DELAYED
}

enum MatchStatus {
  PENDING
  ACCEPTED
  REJECTED
  EXPIRED
}

enum MatchType {
  SPORTS
  SOCIAL
  VOLUNTEER
  STUDY
  PROFESSIONAL
  HOBBY
}

enum NotificationType {
  EVENT
  MATCH
  POINTS
  MESSAGE
  SYSTEM
  VOUCH
  SERVICE
  MARKETPLACE
  PAYMENT
}

enum OrderStatus {
  CART
  PENDING
  CONFIRMED
  SHIPPED
  DELIVERED
  CANCELED
  REFUNDED
  DISPUTED
}

enum PaymentStatus {
  PENDING
  PROCESSING
  SUCCEEDED
  FAILED
  CANCELED
  REFUNDED
  PARTIALLY_REFUNDED
}

enum PayoutStatus {
  PENDING
  PROCESSING
  RELEASED
  HELD
  FAILED
  CANCELED
}

enum PricingType {
  PER_HOUR
  PER_DAY
  PER_PERSON
  PER_NIGHT
  FIXED
}

enum RedemptionStatus {
  PENDING
  APPROVED
  REJECTED
}

enum ReferralRewardStatus {
  PENDING
  APPROVED
  AWARDED
  CLAIMED
  EXPIRED
  CANCELED
}

enum ServiceStatus {
  DRAFT
  ACTIVE
  PAUSED
  INACTIVE
  SUSPENDED
}

enum ServiceType {
  GUIDING
  HOMESTAY
  TUTORING
  CONSULTATION
  TRANSPORT
  OTHER
}

enum SubscriptionStatus {
  ACTIVE
  TRIALING
  PAST_DUE
  CANCELED
  EXPIRED
  PAUSED
  INCOMPLETE
}

enum TransactionType {
  EVENT_TICKET
  MARKETPLACE_ORDER
  SERVICE_BOOKING
  SUBSCRIPTION
  DONATION
  REFUND
}

enum UserRole {
  GENERAL_USER
  GUIDE
  MODERATOR
  ADMIN
}

enum UserStatus {
  ACTIVE
  DEACTIVATED
  BANNED
  PENDING
}

enum VouchStatus {
  PENDING
  APPROVED
  ACTIVE
  REVOKED
}

enum VouchType {
  PRIMARY
  SECONDARY
  COMMUNITY
}
