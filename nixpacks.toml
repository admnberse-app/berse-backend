[phases.setup]
nixPkgs = ['nodejs-20_x', 'npm-9_x']

[phases.install]
# Use npm install instead of ci for better compatibility
cmds = ['npm install --production=false']

[phases.build]
# Generate Prisma client and build TypeScript
cmds = ['npx prisma generate', 'npm run build']

[start]
# Run migrations and start production server
cmd = 'npx prisma migrate deploy && npm run start:prod'